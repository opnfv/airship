---
# The purpose of this file is to define all of the NetworkLinks (i.e. layer 1
# devices) and Networks (i.e. layer 3 configurations). The following is standard
# for the logical networks in NC:
#
# +----------+-----------------------------------+----------------+--------------+----------------------------------------------------+-----------------+
# | Network  |                                   | Per-rack or    |              |                                                    |   VLAN tagged   |
# |   Name   |             Purpose               | per-site CIDR? | Has gateway? |                    Bond                            |  or untagged?   |
# +----------+-----------------------------------+----------------+--------------+----------------------------------------------------+-----------------+
# |   oob    | Out of Band devices (iDrac/iLo)   | per-rack CIDR  | Has gateway  |                No bond, N/A                        | Untagged/Native |
# |   pxe    | PXE boot network                  | per-rack CIDR  | No gateway   | No bond, no LACP fallback. Dedicated PXE interface | Untagged/Native |
# |   oam    | management net; k8s traffic       | per-site CIDR  | Has gateway  |               member of bond1                      |     tagged      |
# | storage  | storage network                   | per-site CIDR  | No gateway   |               member of bond1                      |     tagged      |
# |  calico  | underlay calico network           | per-site CIDR  | No gateway   |               member of bond1                      |     tagged      |
# | overlay  | overlay network for openstack SDN | per-site CIDR  | No gateway   |               member of bond1                      |     tagged      |
# | routable | OVS-F (OVS Floating IP – Public)  | per-site CIDR  | Has gateway  |               member of bond1                      |     tagged      |
# +----------+-----------------------------------+----------------+--------------+----------------------------------------------------+-----------------+
#
# For standard NC deployments, you should not need to modify the number of
# NetworkLinks and Networks in this file. Only the metadata name, the IP addresses and CIDRs should
# need editing.
#
# NOTE: For FQDN naming conventions, refer to the following:
# 1st rack PXE & OOB NetworkLink & Network definition
# NEWSITE-CHANGEME: Update each "rack" reference below (metadata.name, data.trunking.default_network,
# data.allowed_networks) with an applicable name for this site & rack
---
schema: 'drydock/NetworkLink/v1'
metadata:
  schema: 'metadata/Document/v1'
  name: bond1
  labels:
    link_role: bond1
    topology: cruiser
  layeringDefinition:
    abstract: false
    layer: type
  storagePolicy: cleartext
data:
  labels:
    noconfig: enabled
  mtu: 9214
  bonding:
    mode: 802.3ad
    hash: layer3+4
    peer_rate: fast
    mon_rate: 100
    up_delay: 1000
    down_delay: 3000
  linkspeed: auto
  trunking:
    mode: 802.1q
  allowed_networks:
    - oam
    - storage
    - overlay
    - calico
...
---
schema: 'drydock/Network/v1'
metadata:
  schema: 'metadata/Document/v1'
  name: oob
  layeringDefinition:
    abstract: false
    layer: site
    parentSelector:
      network_role: oob
      topology: cruiser
    actions:
      - method: merge
        path: .
  storagePolicy: cleartext
data:
  # NEWSITE-CHANGEME: Update with this particular rack's out-of-band CIDR
  cidr: 10.10.139.0/24
  routes:
    # NEWSITE-CHANGEME: Update with this practicular rack's out-of-band gateway IP
    - subnet: '0.0.0.0/0'
      gateway: 10.10.139.1
      metric: 100
...
# NEWSITE-CHANGEME: Update each "rack" reference below (metadata.name, data.trunking.default_network,
# data.allowed_networks) with an applicable name for this site & rack
---
schema: 'drydock/Network/v1'
metadata:
  schema: 'metadata/Document/v1'
  name: pxe
  layeringDefinition:
    abstract: false
    layer: site
    parentSelector:
      network_role: pxe
      topology: cruiser
    actions:
      - method: merge
        path: .
  storagePolicy: cleartext
data:
  # NEWSITE-CHANGEME: Set the VLAN ID for the PXE network
  # or '0' for untagged VLAN
  vlan: '0'
  # NEWSITE-CHANGEME: Update with the site's PXE network CIDR
  # NOTE: The CIDR minimum size = (number of nodes * 2) + 10
  cidr: 10.200.212.0/24
  # PXE network default gateway. Required.
  routes:
    - subnet: 0.0.0.0/0
      # NEWSITE-CHANGEME: Set the PXE network gateway IP address
      gateway: 10.200.212.1
      metric: 100
  # NOTE: The first 20 IPs in the subnet are reserved for network infrastructure.
  # The remainder of the range is divided between two subnets of equal size:
  # one static, and one DHCP.
  # The DHCP addresses are used when nodes perform a PXE boot (DHCP address gets
  # assigned), and when a node is commissioning in MaaS (also uses DHCP to get
  # its IP address). However, when MaaS installs the operating system
  # ("Deploying/Deployed" states), it will write a static IP assignment to
  # /etc/network/interfaces[.d] with IPs from the "static" subnet defined here.
  ranges:
    # NEWSITE-CHANGEME: Update to the first 10 IPs in the CIDR
    - type: reserved
      start: 10.200.212.1
      end: 10.200.212.20
    # NEWSITE-CHANGEME: Update to the first half of the remaining range after
    # excluding the 10 reserved IPs.
    - type: static
      start: 10.200.212.21
      end: 10.200.212.40
    # NEWSITE-CHANGEME: Update to the second half of the remaining range after
    # excluding the 10 reserved IPs.
    - type: dhcp
      start: 10.200.212.41
      end: 10.200.212.128
...
---
schema: 'drydock/Network/v1'
metadata:
  schema: 'metadata/Document/v1'
  name: oam
  layeringDefinition:
    abstract: false
    layer: site
    parentSelector:
      network_role: oam
      topology: cruiser
    actions:
      - method: merge
        path: .
  storagePolicy: cleartext
data:
  # NEWSITE-CHANGEME: Set the VLAN ID for the OAM network
  # or '0' for untagged VLAN
  vlan: '201'
  # NEWSITE-CHANGEME: Set the CIDR for the OAM network
  # NOTE: The CIDR minimum size = number of nodes + 10
  cidr: 10.200.201.0/24
  routes:
    - subnet: 0.0.0.0/0
      # NEWSITE-CHANGEME: Set the OAM network gateway IP address
      gateway: 10.200.201.1
      metric: 100
  ranges:
    # NEWSITE-CHANGEME: Update to the first 20 IPs in the CIDR
    - type: reserved
      start: 10.200.201.1
      end: 10.200.201.20
    # NEWSITE-CHANGEME: Update static range that will be used for the nodes.
    # See minimum range required for the nodes in baremetal/nodes.yaml.
    - type: static
      start: 10.200.201.21
      end: 10.200.201.40
...
---
schema: 'drydock/Network/v1'
metadata:
  schema: 'metadata/Document/v1'
  name: storage
  layeringDefinition:
    abstract: false
    layer: site
    parentSelector:
      network_role: storage
      topology: cruiser
    actions:
      - method: merge
        path: .
  storagePolicy: cleartext
data:
  vlan: '213'
  # NEWSITE-CHANGEME: Set the CIDR for the storage network
  # NOTE: The CIDR minimum size = number of nodes + 10
  cidr: 10.200.213.0/24
  ranges:
    # NEWSITE-CHANGEME: Update to the first 20 IPs in the CIDR
    - type: reserved
      start: 10.200.213.1
      end: 10.200.213.20
    # NEWSITE-CHANGEME: Update to the remaining range after excluding the 10
    # 10 reserved IPs.
    - type: static
      start: 10.200.213.21
      end: 10.200.213.254
...
---
schema: 'drydock/Network/v1'
metadata:
  schema: 'metadata/Document/v1'
  name: calico
  layeringDefinition:
    abstract: false
    layer: site
    parentSelector:
      network_role: calico
      topology: cruiser
    actions:
      - method: merge
        path: .
  storagePolicy: cleartext
data:
  vlan: '214'
  # NEWSITE-CHANGEME: Set the CIDR for the calico network
  # NOTE: The CIDR minimum size = number of nodes + 10
  cidr: 10.200.214.0/24
  ranges:
    # NEWSITE-CHANGEME: Update to the first 10 IPs in the CIDR  - type: reserved
    - type: reserved
      start: 10.200.214.1
      end: 10.200.214.20
    # NEWSITE-CHANGEME: Update to the remaining range after excluding the 10
    # 10 reserved IPs.
    - type: static
      start: 10.200.214.21
      end: 10.200.214.254
...
---
schema: 'drydock/Network/v1'
metadata:
  schema: 'metadata/Document/v1'
  name: overlay
  layeringDefinition:
    abstract: false
    layer: site
    parentSelector:
      network_role: os-overlay
      topology: cruiser
    actions:
      - method: merge
        path: .
  storagePolicy: cleartext
data:
  vlan: '215'
  # NEWSITE-CHANGEME: Set the CIDR for the overlay network
  # NOTE: The CIDR minimum size = number of nodes + 10
  cidr: 10.200.215.0/24
  ranges:
    # NEWSITE-CHANGEME: Update to the first 10 IPs in the CIDR
    - type: reserved
      start: 10.200.215.1
      end: 10.200.215.20
    # NEWSITE-CHANGEME: Update to the remaining range after excluding the 10
    # 10 reserved IPs.
    - type: static
      start: 10.200.215.21
      end: 10.200.215.254
  routes:
    - subnet: 0.0.0.0/0
      # NEWSITE-CHANGEME: Update to the gateway address for this network
      gateway: 10.200.215.1
  labels:
    # NEWSITE-CHANGEME: All cruisers should have this enabled, set to false if this
    #  is a special case. If set to false, IP Addresses and CIDR will still need
    #  to be specified above to satisfy the schema and substitution used by other documents.
    enabled: true
...
---
schema: 'drydock/Network/v1'
metadata:
  schema: 'metadata/Document/v1'
  name: routable
  layeringDefinition:
    abstract: false
    layer: site
    parentSelector:
      network_role: os-routable
      topology: cruiser
    actions:
      - method: merge
        path: .
  storagePolicy: cleartext
data:
  vlan: '202'
  # NEWSITE-CHANGEME: Set the CIDR for the OVS-F (OVS Floating IP – Public) network
  cidr: 10.200.202.0/24
  ranges:
    - type: reserved
      # NEWSITE-CHANGEME: Update to the start and end addresses to be used for the Floating IP pool
      start: 10.200.202.2
      end: 10.200.202.254
  routes:
    - subnet: 0.0.0.0/0
      # NEWSITE-CHANGEME: Update to the gateway address for this network
      gateway: 10.200.202.1
      metric: 100
  labels:
    # NEWSITE-CHANGEME: All cruisers should have this enabled, set to false if this
    #     is a special case in corridor 1 that doesn't support a floating IP pool.
    #     If set to false, IP Addresses and CIDR will still need to be specified
    #     above to satisfy the schema and substitution used by other documents.
    enabled: true
...
